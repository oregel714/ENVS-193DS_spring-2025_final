---
title: "193DS_final"
author: "Mark Oregel"
date: "June 11, 2025"
format: html
html: 
    toc: true 
    toc-depth: 5
---

### GitHub repository: 
https://github.com/oregel714/ENVS-193DS_spring-2025_final

```{r, message=FALSE}

# reading in packages 
library(tidyverse)
library(here)
library(gt)
library(janitor)
library(readxl)
library(dplyr)
library(MuMIn)
library(DHARMa)
library(lubridate)
library(ggeffects)

# reading in data set 

sst <- read_csv(here("data", "SST_update2023.csv"))

nest_boxes <- read_csv(here("data", "occdist.csv"))

```




# Problem 1: 

a. In part 1, they used a Pearson's correlation test as this would mean that we are trying to understand if there is a correlation between distance from headwater and total nitrogen load. 
In part 2, they used an One-way Analysis of Variance (ANOVA) to determine if there is a difference between the sources of nitrogen and average nitrogen load. 

b. 




# Problem 2: 

### a. Cleaning and Summarizing 

```{r, message=FALSE}

sst_clean <- sst |> # creating new data object from original data set
  select(date, temp) |> # selecting relevant 
  mutate( # changing columns to year and date 
    year = year(date), # specifiying dat as a year  
    month = month(date, label = TRUE, abbr = TRUE) # label and abbreviate the month date 
  ) |> 
  filter(year %in% c(2018, 2019, 2020, 2021, 2022, 2023)) |> # filtering the data for only the specified years 
  select(-date) |> # getting rid of the original date column 
  group_by(year, month) |> # grouping by year and month 
  summarise(mean_monthly_sst = mean(temp, na.rm = TRUE), .groups = "drop")  |> # summarizing  the mean monthly surface temperatures 
  mutate(mean_monthly_sst = round(mean_monthly_sst, 1), year = as.factor(year)) # changing the 'mean_monthly_sst' to be rounded and setting 'year' as a factor 

sst_clean |> # taking the 'sst_clean' object and sampling 5 observations 
  slice_sample(n=5)

str(sst_clean) # displaying the sample 
```

### b. Visualization 
```{r, message=FALSE}

ggplot(data = sst_clean, # starting with data set 'sst_clean' 
       aes(x = month, # setting x axis as 'month'
           y = mean_monthly_sst, # setting y axis as 'mean_monthly_sst'
           group = year, # grouping by year 
           color = year # coloring the year 
           )) +
  geom_line(linewidth = 0.5) + # setting the size of the line 
  geom_point(linewdith = 2) + # setting the size of the points representing the means
  scale_color_manual( # setting the colors of each year manually 
    values = c(
      "2023" = "#292f56",
      "2022" = "#1e4572",
      "2021" = "#005c8b",
      "2020" = "#007498",
      "2019" = "#008ba0",
      "2018" = "#00a3a4"
    )
  ) +
  scale_x_discrete( # abbreviating the months on the x axis 
    limits = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
  ) +
  
  theme_bw() + # setting the theme to black and white 
  labs(y = "Mean monthly sea surface temperature (Â°C)", # setting titles for axes 
       x = "Month",
       color = "Year"
       ) + 
  theme( # changing the size/position of the text in the legend and axes to fit the graph 
    legend.position = c(0.1, 0.75), 
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    axis.title = element_text(size = 13),
    axis.text = element_text(size = 11),
    panel.grid.major = element_blank(), # removing the grids/panels in the back of the graph
    panel.grid.minor = element_blank(),
    
  )
```

# Problem 3: 

```{r, message=FALSE}

clean_nb <- nest_boxes |> # creating new data object 
  clean_names() |> # cleaning names of columns 
  select(-box, -event_id, -repeated_use) |> # de-selecting 
  mutate(season = as.factor(season)) # indicating 'season' as a factor 

```


### a. Response Variable:

Biologically speaking, the 1s and 0s are binary values indicating which species is present in the nest box for the observation. There are three species, whichever species is present for that observation, a 1 denotes the presence of the species or an empty box while the other species are denoted by 0s to indicate their absence. 

### b. Purpose of Study: 

In the context of the study, nesting boxes are targeted towards the Swift Parrot species while the other species of interest, Common Starling and Tree Martin, are competitors who have been exploiting the nesting boxes more than the Swift Parrots. 

### c. Difference in "seasons":

The two seasons (years) the authors are referring to are 2016 and 2019. Subordinate native nest competitors increased the likelihood of box occupancy the farther away from the forest edge in both years, however, this relationship was observed to be stronger in 2019. 

### d. Table of models: 

4 models total:

| Model # | Season | Distance to forest edge   | Model description          |  
|:-------:|:------:|:-------------------------:|:--------------------------:|  
| 0       |        |                           | no predictors (null model) |
| 1       |    X   |            X              | all predictors (full model)| 
| 2       |    X   |                           | season                     | 
| 3       |        |            X              | distance to forest edge    |

### e. Run the models:

```{r, message=FALSE}

# model 0: null model 
model0 <- glm(
  sp ~ 1, # formula for null model 
  data = clean_nb, # data frame
  family = "binomial" # indicating distribution 
)

# model 1: saturated model 
model1 <- glm(
  sp ~ edge_distance + season,
  data = clean_nb,
  family = "binomial"
)

# model 2: season 
model2 <- glm(
  sp ~ season,
  data = clean_nb,
  family = "binomial"
)

# model 3: distance from forest edge 
model3 <- glm(
  sp ~ edge_distance,
  data = clean_nb,
  family = "binomial"
)

```

f. Check the diagnostics 

```{r, message=FALSE, model-diagnostics}
 
plot(
  simulateResiduals(model0)
)
plot(
  simulateResiduals(model1)
)
plot(
  simulateResiduals(model2)
)
plot(
  simulateResiduals(model3)
)

```

# g. Select the best model: 

```{r model-selection, message=FALSE}

# using Akaike's Information Criterion to choose the best model 
AICc(
  model0,
  model1,
  model2,
  model3
) |> 
  arrange(AICc)

```

The best model as determined by Akaike's Information Criterion (ACI) uses season and edge distance. 

### h. Visualize the model predictions: 

```{r visiualizing the model predictions, message=FALSE}

mod_preds <- ggpredict(model1,
          terms = c("edge_distance [all]", "season"))

ggplot(clean_nb,
       aes(x = edge_distance,
           y = sp,
           color = season)) + 
  geom_point(data = clean_nb,
             size = 2,
             alpha = 0.4) + 
  geom_ribbon(data = mod_preds,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high,
                  fill = group),
              alpha = 0.4,
              color = NA) + 
  geom_line(data = mod_preds,
            aes(x = x,
                y = predicted,
                color = group),
            linewidth = 1) +
  scale_y_continuous(limits = c(0, 1),
                     breaks = c(0, 1)) + 
  theme_bw() + 
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) + 
  labs(x = "Distance from the forest edge (meters)",
       y = "Swift parrot occupancy probability",
       color = "Year",
       fill = "Year"
       
  ) + 
  scale_color_manual(values = c("2016" = "olivedrab",
                                "2019" = "blue")) + 
  scale_fill_manual(values = c("2016" = "olivedrab",
                               "2019" = "blue"))

```

### i. Write a caption for your figure: 

**Figure 1: The probability of Swift Parrot occupancy in a nesting box tends to decrease the farther away it is located from the forest edge.**  Data from "Do nest boxes breed the target species or its competitors? A case study of a critically endangered bird" (Stojanovic et. al, October 28, 2021; https://doi.org/10.5061/dryad.83bk3j9sb). Data points represent swift parrot occupancy as either occupied (1, n =) or unoccupied (0, n= ). The solid lines represnt predicted probabilities resulting from a bionomial logistic regression model. The shaded ribbons surrounding the lines represent a 95% confidence interval around the predictions. The two different colors represent our two seasons of interest, 2016 and 2019. 

### j. Calculate the model predictions: 

```{r calculating model1 predictions, message=FALSE}

ggpredict(model1)


```



# Problem 4: 

### a. Comparing visualizations:

The visualization that I made for homework 2 was simple and did not display anything meaningful about my data and the patterns that were present. Granted this was when I had very few observations, but my point still stands. My visualization for homework 3 had means between groups, standard error, and quantiles expressing what I had hoped to gather from my personal observations. 

A similarity that I found is that I chose the same groups that I represented in homework 3 in homework 2 as well. Additionally, I decided to stay with 'money spent' as one of my variables for my visualizations in both homework 2 and 3. 

There aren't very many patterns in my homework 2 visualization other than that I classified my days where I am on campus longer than 6 hours as my long days and days less than 6 hours as my short days. There are more obvious patterns in my homework 3 visualization as this is where I was able to fully display my observations. I noticed that I typically spend more money on long days and on short days, I have a noticeable amount of observations where I spend no money at all. This makes perfect sense as I do my best to not spend money on days where I am on campus for a short amount of time, but alas, these observations would say otherwise. 

The feedback I received in week 9 in workshop primarily pertained to my artist statement and my use of drawings. People recommended that I implement a physical aspect to the visualization as my drawings would be able to be replicated onto the physical objects themselves; these being a yerba mate can and a coffee cup. I ended up drawing the points on these physical objects with a marker to make it stand out, unfortunately, my roommate mistook them as trash on our dining room table and threw them away :(. 

### b. Sharing your affective visualization

I attended workshop :). 









